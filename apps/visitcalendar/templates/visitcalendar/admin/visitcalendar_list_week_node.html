{% extends "real_estate_app/base.html" %}

{% block head %}
<script src="/admin-media/js/jquery.min.js" type="text/javascript"></script>
<script src="/admin-media/js/jquery.init.js" type="text/javascript"></script>
<script src="{{ MEDIA_REAL_ESTATE }}js/fullcalendar/fullcalendar.min.js"></script>
<script src="{{ MEDIA_REAL_ESTATE }}js/moment.js" ></script>
<link rel="stylesheet" href="{{ MEDIA_REAL_ESTATE }}js/fullcalendar/fullcalendar.css" />
{% if not show_events %}
<link rel="stylesheet" href="{{ MEDIA_REAL_ESTATE }}css/visitcalendar/fullcalendar-noevents.css" />
{% endif %}
<link media="print" rel="stylesheet" href="{{ MEDIA_REAL_ESTATE }}js/fullcalendar/fullcalendar.print.css" />


<script type="text/javascript">
(function($) {
	$(document).ready(function() {
		options_plugin={{ fullcalendar_options|safe }};
		options={
					selectable: true,
					{% if add_url %}
						dayClick: function(date, allDay, jsEvent, view) {
							date_format=moment(date).format('YYYY-MM-DD HH:mm:ss')
							window.location="{{ add_url }}?date_visit="+date_format{% if property %}+"&property_fk="+{{ property.id }}{% endif %}
							$('#calendar').fullCalendar('unselect');
						},
					{% endif %}
					events: function(tart, end, callback) {
						$.ajax({
	            				url: "{%if property %}{% url visitcalendar-list-json property|slugify %} {% else %} {% url visitcalendar-list-json-index %} {% endif %}",
	            				dataType: 'json',
	            				success: function(doc) {
	            					var events = [];
	            					$(doc).each(function(){
	            						events.push({
	            							title:$(this).attr('title'),
	            							start:$(this).attr('start'),
	            							allDay: false,
	            						});

	            					})
	            					callback(events);
	            				}
				        });
					},
					{% if not show_events %}
						eventRender: function(event, element, view) {
							if (view.name == 'month') {
								day=$.fullCalendar.formatDate(event.start,'yyyy-MM-dd');
								$('td[data-date='+day+']').addClass('fullcalendar-noevents')
								return false
							}
						},
					{% endif %}
		};
		$calendar=$('#calendar').fullCalendar(
			$.extend(options_plugin,options)
		);
			$('.fc-button-month').click(function() { $calendar.fullCalendar('refetchEvents')})
			$('.fc-button-agendaWeek').click(function() { $calendar.fullCalendar('refetchEvents')})
			$('.fc-button-agendaDay').click(function() { $calendar.fullCalendar('refetchEvents')})
	})
})(django.jQuery);
</script>
{% endblock %}


{% block content_main %}
	{{ add_url }}
	<div id="calendar"></div>
{% endblock %}